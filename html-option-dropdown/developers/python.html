

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python Development &#8212; Apache Arrow v3.0.0.dev641+ge8678380d</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.5d5914fd1cc083e2424bb9c5e974de8e.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.90951cbc93101d5860c0.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Daily Development using Archery" href="archery.html" />
    <link rel="prev" title="Fuzzing Arrow C++" href="cpp/fuzzing.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">

    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
      <symbol id="svg-toc" viewBox="0 0 24 24">
        <title>Contents</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
          stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z"/>
          <line x1="4" y1="6" x2="20" y2="6" />
          <line x1="10" y1="12" x2="20" y2="12" />
          <line x1="6" y1="18" x2="20" y2="18" />
        </svg>
      </symbol>
      <symbol id="svg-menu" viewBox="0 0 24 24">
        <title>Menu</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
          class="feather feather-menu">
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </symbol>
      <symbol id="svg-arrow-right" viewBox="0 0 24 24">
        <title>Expand</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
          class="feather feather-chevron-right">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </symbol>
    </svg>
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">


    
      
      <a class="navbar-brand" href="../index.html">
        <img src="../_static/arrow.png" class="logo" alt="logo">
      </a>
      
    

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    

      <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
        <ul id="navbar-main-elements" class="navbar-nav mr-auto">
          <li class="toctree-l1  nav-item">
            <a class="reference internal nav-link" href="../format.html">
              Specifications and Protocols
            </a>
          </li>
  
          <li class="toctree-l1  nav-item dropdown">
            <a class="reference internal nav-link dropdown-toggle" href="#"
            id="navbarDropdownLibraries" role="button" data-toggle="dropdown"
            aria-haspopup="true" aria-expanded="false">
              Libraries
            </a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdownGetArrow">
              <a class="reference internal nav-link" href="../status.html">
                Implementation Status
               </a>
               <a class="reference external nav-link" href="https://arrow.apache.org/docs/c_glib/">
                C/GLib
               </a>
               <a class="reference internal nav-link" href="../cpp/index.html">
                C++
               </a>
               <a class="reference external nav-link" href="https://github.com/apache/arrow/blob/master/csharp/README.md">
                C#
               </a>
               <a class="reference external nav-link" href="https://godoc.org/github.com/apache/arrow/go/arrow">
                Go
               </a>
               <a class="reference internal nav-link" href="../java/index.html">
                Java
               </a>
               <a class="reference external nav-link" href="https://arrow.apache.org/docs/js/">
                JavaScript
               </a>
               <a class="reference external nav-link" href="https://github.com/apache/arrow/blob/master/julia/Arrow/README.md">
                Julia
               </a>
               <a class="reference external nav-link" href="https://github.com/apache/arrow/blob/master/matlab/README.md">
                MATLAB
               </a>
               <a class="reference internal nav-link" href="../python/index.html">
                Python
               </a>
               <a class="reference external nav-link" href="https://arrow.apache.org/docs/r/">
                R
               </a>
               <a class="reference external nav-link" href="https://github.com/apache/arrow/blob/master/ruby/README.md">
                Ruby
               </a>
               <a class="reference external nav-link" href="https://docs.rs/crate/arrow/">
                Rust
               </a>
              </div>
            </li>

          <li class="toctree-l1 active nav-item">
            <a class="reference internal nav-link" href="../developers.html">
              Development
            </a>
          </li>
        </ul>


      

      <ul class="navbar-nav">
        
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/apache/arrow" target="_blank" rel="noopener">
              <span><i class="fab fa-github-square"></i></span>
            </a>
          </li>
        
        
        
          <li class="nav-item">
            <a class="nav-link" href="https://twitter.com/ApacheArrow" target="_blank" rel="noopener">
              <span><i class="fab fa-twitter-square"></i></span>
            </a>
          </li>
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <!-- <ul class="nav bd-sidenav"> -->
      
      <ul class="current nav bd-sidenav testest">
 <li class="toctree-l2">
  <a class="reference internal" href="contributing.html">
   Contributing to Apache Arrow
  </a>
 </li>
 <li class="toctree-l2 has-children">
  <a class="reference internal" href="cpp/index.html">
   C++ Development
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="icon">
    <svg>
     <use href="#svg-arrow-right">
     </use>
    </svg>
   </i>
  </label>
  <ul>
   <li class="toctree-l3">
    <a class="reference internal" href="cpp/building.html">
     Building Arrow C++
    </a>
   </li>
   <li class="toctree-l3">
    <a class="reference internal" href="cpp/development.html">
     Development Guidelines
    </a>
   </li>
   <li class="toctree-l3">
    <a class="reference internal" href="cpp/windows.html">
     Developing on Windows
    </a>
   </li>
   <li class="toctree-l3">
    <a class="reference internal" href="cpp/conventions.html">
     Conventions
    </a>
   </li>
   <li class="toctree-l3">
    <a class="reference internal" href="cpp/fuzzing.html">
     Fuzzing Arrow C++
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l2 current active current-page">
  <a class="current reference internal" href="#">
   Python Development
  </a>
 </li>
 <li class="toctree-l2">
  <a class="reference internal" href="archery.html">
   Daily Development using Archery
  </a>
 </li>
 <li class="toctree-l2">
  <a class="reference internal" href="crossbow.html">
   Packaging and Testing with Crossbow
  </a>
 </li>
 <li class="toctree-l2">
  <a class="reference internal" href="docker.html">
   Running Docker Builds
  </a>
 </li>
 <li class="toctree-l2">
  <a class="reference internal" href="benchmarks.html">
   Benchmarks
  </a>
 </li>
 <li class="toctree-l2">
  <a class="reference internal" href="documentation.html">
   Building the Documentation
  </a>
 </li>
</ul>
      
    <!-- </ul> -->
  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#coding-style">
   Coding Style
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#unit-testing">
   Unit Testing
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#test-groups">
     Test Groups
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#benchmarking">
     Benchmarking
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#building-on-linux-and-macos">
   Building on Linux and MacOS
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#system-requirements">
     System Requirements
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#environment-setup-and-build">
     Environment Setup and Build
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#using-conda">
       Using Conda
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#using-pip">
       Using pip
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#build-and-test">
     Build and test
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#docker-examples">
       Docker examples
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#building-with-cuda-support">
       Building with CUDA support
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#debugging">
     Debugging
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#using-gdb-on-linux">
       Using gdb on Linux
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#building-on-windows">
   Building on Windows
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#running-c-unit-tests-for-python-integration">
     Running C++ unit tests for Python integration
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#windows-caveats">
     Windows Caveats
    </a>
   </li>
  </ul>
 </li>
</ul>

</nav>


              
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="python-development">
<span id="id1"></span><h1>Python Development<a class="headerlink" href="#python-development" title="Permalink to this headline">¶</a></h1>
<p>This page provides general Python development guidelines and source build
instructions for all platforms.</p>
<div class="section" id="coding-style">
<h2>Coding Style<a class="headerlink" href="#coding-style" title="Permalink to this headline">¶</a></h2>
<p>We follow a similar PEP8-like coding style to the <a class="reference external" href="https://github.com/pandas-dev/pandas">pandas project</a>.  To check style issues, use the
<a class="reference internal" href="archery.html#archery"><span class="std std-ref">Archery</span></a> subcommand <code class="docutils literal notranslate"><span class="pre">lint</span></code>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip install -e arrow/dev/archery
pip install -r arrow/dev/archery/requirements-lint.txt
</pre></div>
</div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>archery lint --python
</pre></div>
</div>
<p>Some of the issues can be automatically fixed by passing the <code class="docutils literal notranslate"><span class="pre">--fix</span></code> option:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>archery lint --python --fix
</pre></div>
</div>
</div>
<div class="section" id="unit-testing">
<h2>Unit Testing<a class="headerlink" href="#unit-testing" title="Permalink to this headline">¶</a></h2>
<p>We are using <a class="reference external" href="https://docs.pytest.org/en/latest/">pytest</a> to develop our unit
test suite. After building the project (see below) you can run its unit tests
like so:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pytest pyarrow
</pre></div>
</div>
<p>Package requirements to run the unit tests are found in
<code class="docutils literal notranslate"><span class="pre">requirements-test.txt</span></code> and can be installed if needed with <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-r</span>
<span class="pre">requirements-test.txt</span></code>.</p>
<p>The project has a number of custom command line options for its test
suite. Some tests are disabled by default, for example. To see all the options,
run</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pytest pyarrow --help
</pre></div>
</div>
<p>and look for the “custom options” section.</p>
<div class="section" id="test-groups">
<h3>Test Groups<a class="headerlink" href="#test-groups" title="Permalink to this headline">¶</a></h3>
<p>We have many tests that are grouped together using pytest marks. Some of these
are disabled by default. To enable a test group, pass <code class="docutils literal notranslate"><span class="pre">--$GROUP_NAME</span></code>,
e.g. <code class="docutils literal notranslate"><span class="pre">--parquet</span></code>. To disable a test group, prepend <code class="docutils literal notranslate"><span class="pre">disable</span></code>, so
<code class="docutils literal notranslate"><span class="pre">--disable-parquet</span></code> for example. To run <strong>only</strong> the unit tests for a
particular group, prepend <code class="docutils literal notranslate"><span class="pre">only-</span></code> instead, for example <code class="docutils literal notranslate"><span class="pre">--only-parquet</span></code>.</p>
<p>The test groups currently include:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">gandiva</span></code>: tests for Gandiva expression compiler (uses LLVM)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hdfs</span></code>: tests that use libhdfs or libhdfs3 to access the Hadoop filesystem</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hypothesis</span></code>: tests that use the <code class="docutils literal notranslate"><span class="pre">hypothesis</span></code> module for generating
random test cases. Note that <code class="docutils literal notranslate"><span class="pre">--hypothesis</span></code> doesn’t work due to a quirk
with pytest, so you have to pass <code class="docutils literal notranslate"><span class="pre">--enable-hypothesis</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">large_memory</span></code>: Test requiring a large amount of system RAM</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">orc</span></code>: Apache ORC tests</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">parquet</span></code>: Apache Parquet tests</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">plasma</span></code>: Plasma Object Store tests</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">s3</span></code>: Tests for Amazon S3</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tensorflow</span></code>: Tests that involve TensorFlow</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">flight</span></code>: Flight RPC tests</p></li>
</ul>
</div>
<div class="section" id="benchmarking">
<h3>Benchmarking<a class="headerlink" href="#benchmarking" title="Permalink to this headline">¶</a></h3>
<p>For running the benchmarks, see <a class="reference internal" href="../python/benchmarks.html#python-benchmarks"><span class="std std-ref">Benchmarks</span></a>.</p>
</div>
</div>
<div class="section" id="building-on-linux-and-macos">
<h2>Building on Linux and MacOS<a class="headerlink" href="#building-on-linux-and-macos" title="Permalink to this headline">¶</a></h2>
<div class="section" id="system-requirements">
<h3>System Requirements<a class="headerlink" href="#system-requirements" title="Permalink to this headline">¶</a></h3>
<p>On macOS, any modern XCode (6.4 or higher; the current version is 10) is
sufficient.</p>
<p>On Linux, for this guide, we require a minimum of gcc 4.8, or clang 3.7 or
higher. You can check your version by running</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ gcc --version
</pre></div>
</div>
<p>If the system compiler is older than gcc 4.8, it can be set to a newer version
using the <code class="docutils literal notranslate"><span class="pre">$CC</span></code> and <code class="docutils literal notranslate"><span class="pre">$CXX</span></code> environment variables:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">CC</span><span class="o">=</span>gcc-4.8
<span class="nb">export</span> <span class="nv">CXX</span><span class="o">=</span>g++-4.8
</pre></div>
</div>
</div>
<div class="section" id="environment-setup-and-build">
<h3>Environment Setup and Build<a class="headerlink" href="#environment-setup-and-build" title="Permalink to this headline">¶</a></h3>
<p>First, let’s clone the Arrow git repository:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mkdir repos
<span class="nb">cd</span> repos
git clone https://github.com/apache/arrow.git
</pre></div>
</div>
<p>You should now see</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ ls -l
total <span class="m">8</span>
drwxrwxr-x <span class="m">12</span> wesm wesm <span class="m">4096</span> Apr <span class="m">15</span> <span class="m">19</span>:19 arrow/
</pre></div>
</div>
<p>Pull in the test data and setup the environment variables:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">pushd</span> arrow
git submodule init
git submodule update
<span class="nb">export</span> <span class="nv">PARQUET_TEST_DATA</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PWD</span><span class="si">}</span><span class="s2">/cpp/submodules/parquet-testing/data&quot;</span>
<span class="nb">export</span> <span class="nv">ARROW_TEST_DATA</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PWD</span><span class="si">}</span><span class="s2">/testing/data&quot;</span>
<span class="nb">popd</span>
</pre></div>
</div>
<div class="section" id="using-conda">
<h4>Using Conda<a class="headerlink" href="#using-conda" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Using conda to build Arrow on macOS is complicated by the
fact that the <a class="reference external" href="https://stackoverflow.com/a/55798942">conda-forge compilers require an older macOS SDK</a>.
Conda offers some <a class="reference external" href="https://docs.conda.io/projects/conda-build/en/latest/resources/compiler-tools.html#macos-sdk">installation instructions</a>;
the alternative would be to use <a class="reference internal" href="#python-homebrew"><span class="std std-ref">Homebrew</span></a> and
<code class="docutils literal notranslate"><span class="pre">pip</span></code> instead.</p>
</div>
<p>Let’s create a conda environment with all the C++ build and Python dependencies
from conda-forge, targeting development for Python 3.7:</p>
<p>On Linux and macOS:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>conda create -y -n pyarrow-dev -c conda-forge <span class="se">\</span>
    --file arrow/ci/conda_env_unix.yml <span class="se">\</span>
    --file arrow/ci/conda_env_cpp.yml <span class="se">\</span>
    --file arrow/ci/conda_env_python.yml <span class="se">\</span>
    --file arrow/ci/conda_env_gandiva.yml <span class="se">\</span>
    compilers <span class="se">\</span>
    <span class="nv">python</span><span class="o">=</span><span class="m">3</span>.7 <span class="se">\</span>
    pandas
</pre></div>
</div>
<p>As of January 2019, the <code class="docutils literal notranslate"><span class="pre">compilers</span></code> package is needed on many Linux
distributions to use packages from conda-forge.</p>
<p>With this out of the way, you can now activate the conda environment</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>conda activate pyarrow-dev
</pre></div>
</div>
<p>For Windows, see the <a class="reference internal" href="#building-on-windows">Building on Windows</a> section below.</p>
<p>We need to set some environment variables to let Arrow’s build system know
about our build toolchain:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">ARROW_HOME</span><span class="o">=</span><span class="nv">$CONDA_PREFIX</span>
</pre></div>
</div>
</div>
<div class="section" id="using-pip">
<h4>Using pip<a class="headerlink" href="#using-pip" title="Permalink to this headline">¶</a></h4>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you installed Python using the Anaconda distribution or <a class="reference external" href="https://conda.io/miniconda.html">Miniconda</a>, you cannot currently use <code class="docutils literal notranslate"><span class="pre">virtualenv</span></code>
to manage your development. Please follow the conda-based development
instructions instead.</p>
</div>
<p id="python-homebrew">On macOS, use Homebrew to install all dependencies required for
building Arrow C++:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>brew update <span class="o">&amp;&amp;</span> brew bundle --file<span class="o">=</span>arrow/cpp/Brewfile
</pre></div>
</div>
<p>See <a class="reference internal" href="cpp/building.html#cpp-build-dependency-management"><span class="std std-ref">here</span></a> for a list of dependencies you
may need.</p>
<p>On Debian/Ubuntu, you need the following minimal set of dependencies. All other
dependencies will be automatically built by Arrow’s third-party toolchain.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ sudo apt-get install libjemalloc-dev libboost-dev <span class="se">\</span>
                       libboost-filesystem-dev <span class="se">\</span>
                       libboost-system-dev <span class="se">\</span>
                       libboost-regex-dev <span class="se">\</span>
                       python-dev <span class="se">\</span>
                       autoconf <span class="se">\</span>
                       flex <span class="se">\</span>
                       bison
</pre></div>
</div>
<p>If you are building Arrow for Python 3, install <code class="docutils literal notranslate"><span class="pre">python3-dev</span></code> instead of <code class="docutils literal notranslate"><span class="pre">python-dev</span></code>.</p>
<p>On Arch Linux, you can get these dependencies via pacman.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ sudo pacman -S jemalloc boost
</pre></div>
</div>
<p>Now, let’s create a Python virtualenv with all Python dependencies in the same
folder as the repositories and a target installation folder:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>virtualenv pyarrow
<span class="nb">source</span> ./pyarrow/bin/activate
pip install -r arrow/python/requirements-build.txt <span class="se">\</span>
     -r arrow/python/requirements-test.txt

<span class="c1"># This is the folder where we will install the Arrow libraries during</span>
<span class="c1"># development</span>
mkdir dist
</pre></div>
</div>
<p>If your cmake version is too old on Linux, you could get a newer one via
<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">cmake</span></code>.</p>
<p>We need to set some environment variables to let Arrow’s build system know
about our build toolchain:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">ARROW_HOME</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/dist
<span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/dist/lib:<span class="nv">$LD_LIBRARY_PATH</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="build-and-test">
<h3>Build and test<a class="headerlink" href="#build-and-test" title="Permalink to this headline">¶</a></h3>
<p>Now build and install the Arrow C++ libraries:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mkdir arrow/cpp/build
<span class="nb">pushd</span> arrow/cpp/build

cmake -DCMAKE_INSTALL_PREFIX<span class="o">=</span><span class="nv">$ARROW_HOME</span> <span class="se">\</span>
      -DCMAKE_INSTALL_LIBDIR<span class="o">=</span>lib <span class="se">\</span>
      -DARROW_WITH_BZ2<span class="o">=</span>ON <span class="se">\</span>
      -DARROW_WITH_ZLIB<span class="o">=</span>ON <span class="se">\</span>
      -DARROW_WITH_ZSTD<span class="o">=</span>ON <span class="se">\</span>
      -DARROW_WITH_LZ4<span class="o">=</span>ON <span class="se">\</span>
      -DARROW_WITH_SNAPPY<span class="o">=</span>ON <span class="se">\</span>
      -DARROW_WITH_BROTLI<span class="o">=</span>ON <span class="se">\</span>
      -DARROW_PARQUET<span class="o">=</span>ON <span class="se">\</span>
      -DARROW_PYTHON<span class="o">=</span>ON <span class="se">\</span>
      -DARROW_BUILD_TESTS<span class="o">=</span>ON <span class="se">\</span>
      ..
make -j4
make install
<span class="nb">popd</span>
</pre></div>
</div>
<p>There are a number of optional components that can can be switched ON by
adding flags with <code class="docutils literal notranslate"><span class="pre">ON</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ARROW_FLIGHT</span></code>: RPC framework</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ARROW_GANDIVA</span></code>: LLVM-based expression compiler</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ARROW_ORC</span></code>: Support for Apache ORC file format</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ARROW_PARQUET</span></code>: Support for Apache Parquet file format</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ARROW_PLASMA</span></code>: Shared memory object store</p></li>
</ul>
<p>Anything set to <code class="docutils literal notranslate"><span class="pre">ON</span></code> above can also be turned off. Note that some compression
libraries are needed for Parquet support.</p>
<p>If multiple versions of Python are installed in your environment, you may have
to pass additional parameters to cmake so that it can find the right
executable, headers and libraries.  For example, specifying
<code class="docutils literal notranslate"><span class="pre">-DPython3_EXECUTABLE=$VIRTUAL_ENV/bin/python</span></code> (assuming that you’re in
virtualenv) enables cmake to choose the python executable which you are using.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>On Linux systems with support for building on multiple architectures,
<code class="docutils literal notranslate"><span class="pre">make</span></code> may install libraries in the <code class="docutils literal notranslate"><span class="pre">lib64</span></code> directory by default. For
this reason we recommend passing <code class="docutils literal notranslate"><span class="pre">-DCMAKE_INSTALL_LIBDIR=lib</span></code> because the
Python build scripts assume the library directory is <code class="docutils literal notranslate"><span class="pre">lib</span></code></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you have conda installed but are not using it to manage dependencies,
and you have trouble building the C++ library, you may need to set
<code class="docutils literal notranslate"><span class="pre">-DARROW_DEPENDENCY_SOURCE=AUTO</span></code> or some other value (described
<a class="reference internal" href="cpp/building.html#cpp-build-dependency-management"><span class="std std-ref">here</span></a>)
to explicitly tell CMake not to use conda.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>With older versions of <code class="docutils literal notranslate"><span class="pre">cmake</span></code> (&lt;3.15) you might need to pass <code class="docutils literal notranslate"><span class="pre">-DPYTHON_EXECUTABLE</span></code>
instead of <code class="docutils literal notranslate"><span class="pre">-DPython3_EXECUTABLE</span></code>. See <cite>cmake documentation &lt;https://cmake.org/cmake/help/latest/module/FindPython3.html#artifacts-specification&gt;</cite>
for more details.</p>
</div>
<p>For any other C++ build challenges, see <a class="reference internal" href="cpp/index.html#cpp-development"><span class="std std-ref">C++ Development</span></a>.</p>
<p>Now, build pyarrow:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">pushd</span> arrow/python
<span class="nb">export</span> <span class="nv">PYARROW_WITH_PARQUET</span><span class="o">=</span><span class="m">1</span>
python setup.py build_ext --inplace
<span class="nb">popd</span>
</pre></div>
</div>
<p>If you did not build one of the optional components, set the corresponding
<code class="docutils literal notranslate"><span class="pre">PYARROW_WITH_$COMPONENT</span></code> environment variable to 0.</p>
<p>Now you are ready to install test dependencies and run <a class="reference internal" href="#unit-testing">Unit Testing</a>, as
described above.</p>
<p>To build a self-contained wheel (including the Arrow and Parquet C++
libraries), one can set <code class="docutils literal notranslate"><span class="pre">--bundle-arrow-cpp</span></code>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip install wheel  <span class="c1"># if not installed</span>
python setup.py build_ext --build-type<span class="o">=</span><span class="nv">$ARROW_BUILD_TYPE</span> <span class="se">\</span>
       --bundle-arrow-cpp bdist_wheel
</pre></div>
</div>
<div class="section" id="docker-examples">
<h4>Docker examples<a class="headerlink" href="#docker-examples" title="Permalink to this headline">¶</a></h4>
<p>If you are having difficulty building the Python library from source, take a
look at the <code class="docutils literal notranslate"><span class="pre">python/examples/minimal_build</span></code> directory which illustrates a
complete build and test from source both with the conda and pip/virtualenv
build methods.</p>
</div>
<div class="section" id="building-with-cuda-support">
<h4>Building with CUDA support<a class="headerlink" href="#building-with-cuda-support" title="Permalink to this headline">¶</a></h4>
<p>The <code class="xref py py-mod docutils literal notranslate"><span class="pre">pyarrow.cuda</span></code> module offers support for using Arrow platform
components with Nvidia’s CUDA-enabled GPU devices. To build with this support,
pass <code class="docutils literal notranslate"><span class="pre">-DARROW_CUDA=ON</span></code> when building the C++ libraries, and set the following
environment variable when building pyarrow:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">PYARROW_WITH_CUDA</span><span class="o">=</span><span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="debugging">
<h3>Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h3>
<p>Since pyarrow depends on the Arrow C++ libraries, debugging can
frequently involve crossing between Python and C++ shared libraries.</p>
<div class="section" id="using-gdb-on-linux">
<h4>Using gdb on Linux<a class="headerlink" href="#using-gdb-on-linux" title="Permalink to this headline">¶</a></h4>
<dl class="simple">
<dt>To debug the C++ libraries with gdb while running the Python unit</dt><dd><p>test, first start pytest with gdb:</p>
</dd>
</dl>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>gdb --args python -m pytest pyarrow/tests/test_to_run.py -k <span class="nv">$TEST_TO_MATCH</span>
</pre></div>
</div>
<p>To set a breakpoint, use the same gdb syntax that you would when
debugging a C++ unittest, for example:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>gdb<span class="o">)</span> b src/arrow/python/arrow_to_pandas.cc:1874
No <span class="nb">source</span> file named src/arrow/python/arrow_to_pandas.cc.
Make breakpoint pending on future shared library load? <span class="o">(</span>y or <span class="o">[</span>n<span class="o">])</span> y
Breakpoint <span class="m">1</span> <span class="o">(</span>src/arrow/python/arrow_to_pandas.cc:1874<span class="o">)</span> pending.
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="building-on-windows">
<h2>Building on Windows<a class="headerlink" href="#building-on-windows" title="Permalink to this headline">¶</a></h2>
<p>Building on Windows requires one of the following compilers to be installed:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://download.visualstudio.microsoft.com/download/pr/3e542575-929e-4297-b6c6-bef34d0ee648/639c868e1219c651793aff537a1d3b77/vs_buildtools.exe">Build Tools for Visual Studio 2017</a></p></li>
<li><p><a class="reference external" href="http://download.microsoft.com/download/5/F/7/5F7ACAEB-8363-451F-9425-68A90F98B238/visualcppbuildtools_full.exe">Microsoft Build Tools 2015</a></p></li>
<li><p>Visual Studio 2015</p></li>
<li><p>Visual Studio 2017</p></li>
</ul>
<p>During the setup of Build Tools ensure at least one Windows SDK is selected.</p>
<p>Visual Studio 2019 and its build tools are currently not supported.</p>
<p>We bootstrap a conda environment similar to above, but skipping some of the
Linux/macOS-only packages:</p>
<p>First, starting from fresh clones of Apache Arrow:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/apache/arrow.git
</pre></div>
</div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>conda create -y -n pyarrow-dev -c conda-forge ^
    --file arrow<span class="se">\c</span>i<span class="se">\c</span>onda_env_cpp.yml ^
    --file arrow<span class="se">\c</span>i<span class="se">\c</span>onda_env_python.yml ^
    --file arrow<span class="se">\c</span>i<span class="se">\c</span>onda_env_gandiva.yml ^
    <span class="nv">python</span><span class="o">=</span><span class="m">3</span>.7
conda activate pyarrow-dev
</pre></div>
</div>
<p>Now, we build and install Arrow C++ libraries.</p>
<p>We set a number of environment variables:</p>
<ul class="simple">
<li><p>the path of the installation directory of the Arrow C++ libraries as
<code class="docutils literal notranslate"><span class="pre">ARROW_HOME</span></code></p></li>
<li><p>add the path of installed DLL libraries to <code class="docutils literal notranslate"><span class="pre">PATH</span></code></p></li>
<li><p>and choose the compiler to be used</p></li>
</ul>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span> <span class="nv">ARROW_HOME</span><span class="o">=</span>%cd%<span class="se">\a</span>rrow-dist
<span class="nb">set</span> <span class="nv">PATH</span><span class="o">=</span>%ARROW_HOME%<span class="se">\b</span>in<span class="p">;</span>%PATH%
<span class="nb">set</span> <span class="nv">PYARROW_CMAKE_GENERATOR</span><span class="o">=</span>Visual Studio <span class="m">15</span> <span class="m">2017</span> Win64
</pre></div>
</div>
<p>This assumes Visual Studio 2017 or its build tools are used. For Visual Studio
2015 and its build tools use the following instead:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span> <span class="nv">PYARROW_CMAKE_GENERATOR</span><span class="o">=</span>Visual Studio <span class="m">14</span> <span class="m">2015</span> Win64
</pre></div>
</div>
<p>Let’s configure, build and install the Arrow C++ libraries:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mkdir arrow<span class="se">\c</span>pp<span class="se">\b</span>uild
<span class="nb">pushd</span> arrow<span class="se">\c</span>pp<span class="se">\b</span>uild
cmake -G <span class="s2">&quot;%PYARROW_CMAKE_GENERATOR%&quot;</span> ^
    -DCMAKE_INSTALL_PREFIX<span class="o">=</span>%ARROW_HOME% ^
    -DCMAKE_UNITY_BUILD<span class="o">=</span>ON ^
    -DARROW_CXXFLAGS<span class="o">=</span><span class="s2">&quot;/WX /MP&quot;</span> ^
    -DARROW_WITH_LZ4<span class="o">=</span>on ^
    -DARROW_WITH_SNAPPY<span class="o">=</span>on ^
    -DARROW_WITH_ZLIB<span class="o">=</span>on ^
    -DARROW_WITH_ZSTD<span class="o">=</span>on ^
    -DARROW_PARQUET<span class="o">=</span>on ^
    -DARROW_PYTHON<span class="o">=</span>on ^
    ..
cmake --build . --target INSTALL --config Release
<span class="nb">popd</span>
</pre></div>
</div>
<p>Now, we can build pyarrow:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">pushd</span> arrow<span class="se">\p</span>ython
<span class="nb">set</span> <span class="nv">PYARROW_WITH_PARQUET</span><span class="o">=</span><span class="m">1</span>
python setup.py build_ext --inplace
<span class="nb">popd</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For building pyarrow, the above defined environment variables need to also
be set. Remember this if to want to re-build <code class="docutils literal notranslate"><span class="pre">pyarrow</span></code> after your initial build.</p>
</div>
<p>Then run the unit tests with:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">pushd</span> arrow<span class="se">\p</span>ython
py.test pyarrow -v
<span class="nb">popd</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>With the above instructions the Arrow C++ libraries are not bundled with
the Python extension. This is recommended for development as it allows the
C++ libraries to be re-built separately.</p>
<p>As a consequence however, <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">install</span></code> will also not install
the Arrow C++ libraries. Therefore, to use <code class="docutils literal notranslate"><span class="pre">pyarrow</span></code> in python, <code class="docutils literal notranslate"><span class="pre">PATH</span></code>
must contain the directory with the Arrow .dll-files.</p>
<p>If you want to bundle the Arrow C++ libraries with <code class="docutils literal notranslate"><span class="pre">pyarrow</span></code> add
<code class="docutils literal notranslate"><span class="pre">--bundle-arrow-cpp</span></code> as build parameter:</p>
<p><code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">build_ext</span> <span class="pre">--bundle-arrow-cpp</span></code></p>
<p>Important: If you combine <code class="docutils literal notranslate"><span class="pre">--bundle-arrow-cpp</span></code> with <code class="docutils literal notranslate"><span class="pre">--inplace</span></code> the
Arrow C++ libraries get copied to the python source tree and are not cleared
by <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">clean</span></code>. They remain in place and will take precedence
over any later Arrow C++ libraries contained in <code class="docutils literal notranslate"><span class="pre">PATH</span></code>. This can lead to
incompatibilities when <code class="docutils literal notranslate"><span class="pre">pyarrow</span></code> is later built without
<code class="docutils literal notranslate"><span class="pre">--bundle-arrow-cpp</span></code>.</p>
</div>
<div class="section" id="running-c-unit-tests-for-python-integration">
<h3>Running C++ unit tests for Python integration<a class="headerlink" href="#running-c-unit-tests-for-python-integration" title="Permalink to this headline">¶</a></h3>
<p>Running C++ unit tests should not be necessary for most developers. If you do
want to run them, you need to pass <code class="docutils literal notranslate"><span class="pre">-DARROW_BUILD_TESTS=ON</span></code> during
configuration of the Arrow C++ library build:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mkdir arrow<span class="se">\c</span>pp<span class="se">\b</span>uild
<span class="nb">pushd</span> arrow<span class="se">\c</span>pp<span class="se">\b</span>uild
cmake -G <span class="s2">&quot;%PYARROW_CMAKE_GENERATOR%&quot;</span> ^
    -DCMAKE_INSTALL_PREFIX<span class="o">=</span>%ARROW_HOME% ^
    -DARROW_CXXFLAGS<span class="o">=</span><span class="s2">&quot;/WX /MP&quot;</span> ^
    -DARROW_PARQUET<span class="o">=</span>on ^
    -DARROW_PYTHON<span class="o">=</span>on ^
    -DARROW_BUILD_TESTS<span class="o">=</span>ON ^
    ..
cmake --build . --target INSTALL --config Release
<span class="nb">popd</span>
</pre></div>
</div>
<p>Getting <code class="docutils literal notranslate"><span class="pre">arrow-python-test.exe</span></code> (C++ unit tests for python integration) to
run is a bit tricky because your <code class="docutils literal notranslate"><span class="pre">%PYTHONHOME%</span></code> must be configured to point
to the active conda environment:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span> <span class="nv">PYTHONHOME</span><span class="o">=</span>%CONDA_PREFIX%
<span class="nb">pushd</span> arrow<span class="se">\c</span>pp<span class="se">\b</span>uild<span class="se">\r</span>elease<span class="se">\R</span>elease
arrow-python-test.exe
<span class="nb">popd</span>
</pre></div>
</div>
<p>To run all tests of the Arrow C++ library, you can also run <code class="docutils literal notranslate"><span class="pre">ctest</span></code>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span> <span class="nv">PYTHONHOME</span><span class="o">=</span>%CONDA_PREFIX%
<span class="nb">pushd</span> arrow<span class="se">\c</span>pp<span class="se">\b</span>uild
ctest
<span class="nb">popd</span>
</pre></div>
</div>
</div>
<div class="section" id="windows-caveats">
<h3>Windows Caveats<a class="headerlink" href="#windows-caveats" title="Permalink to this headline">¶</a></h3>
<p>Some components are not supported yet on Windows:</p>
<ul class="simple">
<li><p>Flight RPC</p></li>
<li><p>Plasma</p></li>
</ul>
</div>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="cpp/fuzzing.html" title="previous page">Fuzzing Arrow C++</a>
    <a class='right-next' id="next-link" href="archery.html" title="next page">Daily Development using Archery</a>

              </div>
              
          </main>
          

      </div>
    </div>

    
  <script src="../_static/js/index.90951cbc93101d5860c0.js"></script>


    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-107500873-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-107500873-1');
</script>

  </body>
</html>