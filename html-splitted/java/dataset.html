
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dataset &#8212; Apache Arrow v8.0.0.dev205+gf59fba46e</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/blank.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/theme_overrides.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="canonical" href="https://arrow.apache.org/docs/java/dataset.html" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Java Reference (javadoc)" href="reference/index.html" />
    <link rel="prev" title="Java Algorithms" href="algorithm.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-107500873-1', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    


    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
<a class="navbar-brand" href="../index.html">
  <img src="../_static/arrow.png" class="logo" alt="logo">
</a>


<div id="subproject-button" class="dropdown">
  <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    placeholder
  </button>
  <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
    
      
      <a class="nav-link" href="../c_glib/index.html">C/GLib</a>
      
    
      
      <a class="nav-link" href="../cpp/index.html">C++</a>
      
    
      
      <a class="nav-link" href="https://github.com/apache/arrow/blob/master/csharp/README.md">C#</a>
      
    
      
      <a class="nav-link" href="https://godoc.org/github.com/apache/arrow/go/arrow">Go</a>
      
    
      
      <a class="nav-link" href="../java/index.html">Java</a>
      
    
      
      <a class="nav-link" href="../js/index.html">JavaScript</a>
      
    
      
      <a class="nav-link" href="https://github.com/apache/arrow/blob/master/julia/Arrow/README.md">Julia</a>
      
    
      
      <a class="nav-link" href="https://github.com/apache/arrow/blob/master/matlab/README.md">MATLAB</a>
      
    
      
      <a class="nav-link" href="../python/index.html">Python</a>
      
    
      
      <a class="nav-link" href="../r/index.html">R</a>
      
    
      
      <a class="nav-link" href="https://github.com/apache/arrow/blob/master/ruby/README.md">Ruby</a>
      
    
      
      <a class="nav-link" href="https://docs.rs/crate/arrow/">Rust</a>
      
    
      
      <a class="nav-link" href="..//status.html/index.html">Implementation status</a>
      
    
      
      <a class="nav-link" href="../format/index.html">Specifications and Protocols</a>
      
    
      
      <a class="nav-link" href="../developers/index.html">Developer documentation</a>
      
    
 </div>
</div>

<div id="version-search-wrapper">

<div id="version-button" class="dropdown">
    <button type="button" class="btn btn-secondary btn-sm navbar-btn dropdown-toggle" id="version_switcher_button" data-toggle="dropdown">
        8.0.0 (dev)
        <span class="caret"></span>
    </button>
    <div id="version_switcher" class="dropdown-menu list-group-flush py-0" aria-labelledby="version_switcher_button">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
</div>

<script type="text/javascript">
// Function to construct the target URL from the JSON components
function buildURL(entry) {
    var template = "https://arrow.apache.org/docs/{version}";  // supplied by jinja
    template = template.replace("{version}", entry.version);
    return template;
}

// Function to check if corresponding page path exists in other version of docs
// and, if so, go there instead of the homepage of the other docs version
function checkPageExistsAndRedirect(event) {
    const currentFilePath = "java/dataset.html",
          otherDocsHomepage = event.target.getAttribute("href");
    let tryUrl = `${otherDocsHomepage}${currentFilePath}`;
    $.ajax({
        type: 'HEAD',
        url: tryUrl,
        // if the page exists, go there
        success: function() {
            location.href = tryUrl;
        }
    }).fail(function() {
        location.href = otherDocsHomepage;
    });
    return false;
}

// Function to populate the version switcher
(function () {
    // get JSON config
    $.getJSON("/docs/_static/versions.json", function(data, textStatus, jqXHR) {
        // create the nodes first (before AJAX calls) to ensure the order is
        // correct (for now, links will go to doc version homepage)
        $.each(data, function(index, entry) {
            // if no custom name specified (e.g., "latest"), use version string
            if (!("name" in entry)) {
                entry.name = entry.version;
            }
            // construct the appropriate URL, and add it to the dropdown
            entry.url = buildURL(entry);
            const node = document.createElement("a");
            node.setAttribute("class", "list-group-item list-group-item-action py-1");
            node.setAttribute("href", `${entry.url}`);
            node.textContent = `${entry.name}`;
            node.onclick = checkPageExistsAndRedirect;
            $("#version_switcher").append(node);
        });
    });
})();
</script>

<form id="search-box" class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>

</div>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
    <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Supported Environments
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../c_glib/index.html">
   C/GLib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/apache/arrow/blob/master/csharp/README.md">
   C#
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://pkg.go.dev/github.com/apache/arrow/go">
   Go
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   Java
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="install.html">
     Installing Java Modules
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="vector.html">
     ValueVector
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="vector_schema_root.html">
     VectorSchemaRoot
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ipc.html">
     Reading/Writing IPC formats
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="algorithm.html">
     Java Algorithms
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Dataset
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="reference/index.html">
     Reference (javadoc)
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../js/index.html">
   JavaScript
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/apache/arrow/blob/master/julia/Arrow/README.md">
   Julia
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/apache/arrow/blob/master/matlab/README.md">
   MATLAB
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../r/index.html">
   R
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/apache/arrow/blob/master/ruby/README.md">
   Ruby
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://docs.rs/crate/arrow/">
   Rust
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../status.html">
   Implementation Status
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Cookbooks
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference external" href="https://arrow.apache.org/cookbook/cpp/">
   C++
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://arrow.apache.org/cookbook/py/">
   Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://arrow.apache.org/cookbook/r/">
   R
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../format/index.html">
   Specifications and Protocols
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../format/Versioning.html">
     Format Versioning and Stability
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../format/Columnar.html">
     Arrow Columnar Format
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../format/Flight.html">
     Arrow Flight RPC
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../format/FlightSql.html">
     Arrow Flight SQL
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../format/Integration.html">
     Integration Testing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../format/CDataInterface.html">
     The Arrow C data interface
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../format/CStreamInterface.html">
     The Arrow C stream interface
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../format/Other.html">
     Other Data Structures
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../developers/index.html">
   Developers documentation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../developers/contributing.html">
     Contributing to Apache Arrow
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../developers/guide/index.html">
     New Contributor’s Guide
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../developers/guide/architectural_overview.html">
       Architectural Overview
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../developers/guide/communication.html">
       Communication
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../developers/guide/step_by_step/index.html">
       Steps in making your first PR
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
      <label for="toctree-checkbox-5">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../developers/guide/step_by_step/set_up.html">
         Set up
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../developers/guide/step_by_step/building.html">
         Building the Arrow libraries 🏋🏿‍♀️
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../developers/guide/step_by_step/finding_issues.html">
         Finding good first issues 🔎
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../developers/guide/step_by_step/arrow_codebase.html">
         Working on the Arrow codebase 🧐
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../developers/guide/step_by_step/testing.html">
         Testing 🧪
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../developers/guide/step_by_step/styling.html">
         Styling 😎
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../developers/guide/step_by_step/pr_lifecycle.html">
         Lifecycle of a pull request
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../developers/guide/documentation.html">
       Helping with documentation
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../developers/guide/tutorials/index.html">
       Tutorials
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
      <label for="toctree-checkbox-6">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../developers/guide/tutorials/python_tutorial.html">
         Python tutorial
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../developers/guide/tutorials/r_tutorial.html">
         R tutorials
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../developers/guide/resources.html">
       Additional information and resources
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../developers/reviewing.html">
     Reviewing contributions
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../developers/cpp/index.html">
     C++ Development
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
    <label for="toctree-checkbox-7">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../developers/cpp/building.html">
       Building Arrow C++
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../developers/cpp/development.html">
       Development Guidelines
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../developers/cpp/windows.html">
       Developing on Windows
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../developers/cpp/conventions.html">
       Conventions
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../developers/cpp/fuzzing.html">
       Fuzzing Arrow C++
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../developers/java/index.html">
     Java Development
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
    <label for="toctree-checkbox-8">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../developers/java/building.html">
       Building Arrow Java
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../developers/java/development.html">
       Development Guidelines
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../developers/python.html">
     Python Development
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../developers/continuous_integration/index.html">
     Continuous Integration
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
    <label for="toctree-checkbox-9">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../developers/continuous_integration/overview.html">
       Continuous Integration
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../developers/continuous_integration/docker.html">
       Running Docker Builds
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../developers/continuous_integration/archery.html">
       Daily Development using Archery
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../developers/continuous_integration/crossbow.html">
       Packaging and Testing with Crossbow
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../developers/benchmarks.html">
     Benchmarks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../developers/documentation.html">
     Building the Documentation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../developers/computeir.html">
     Arrow Compute IR (Intermediate Representation)
    </a>
   </li>
  </ul>
 </li>
</ul>

    
  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#getting-started">
   Getting Started
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#schema">
   Schema
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#projection">
   Projection
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#read-data-from-hdfs">
   Read Data from HDFS
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#native-memory-management">
   Native Memory Management
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#native-object-resource-management">
   Native Object Resource Management
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                

<div class="tocsection editthispage">
    <a href="https://github.com/apache/arrow/edit/master/docs/source/java/dataset.rst">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="dataset">
<h1>Dataset<a class="headerlink" href="#dataset" title="Permalink to this headline">¶</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Experimental: The Java module <code class="docutils literal notranslate"><span class="pre">dataset</span></code> is currently under early
development. API might be changed in each release of Apache Arrow until it
gets mature.</p>
</div>
<p>Dataset is an universal layer in Apache Arrow for querying data in different
formats or in different partitioning strategies. Usually the data to be queried
is supposed to be located from a traditional file system, however Arrow Dataset
is not designed only for querying files but can be extended to serve all
possible data sources such as from inter-process communication or from other
network locations, etc.</p>
<div class="section" id="getting-started">
<h2>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<p>Below shows a simplest example of using Dataset to query a Parquet file in Java:</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="c1">// read data from file /opt/example.parquet</span>
<span class="n">String</span> <span class="n">uri</span> <span class="o">=</span> <span class="s">&quot;file:/opt/example.parquet&quot;</span><span class="p">;</span>
<span class="n">BufferAllocator</span> <span class="n">allocator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RootAllocator</span><span class="p">(</span><span class="n">Long</span><span class="p">.</span><span class="na">MAX_VALUE</span><span class="p">);</span>
<span class="n">DatasetFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileSystemDatasetFactory</span><span class="p">(</span><span class="n">allocator</span><span class="p">,</span>
    <span class="n">NativeMemoryPool</span><span class="p">.</span><span class="na">getDefault</span><span class="p">(),</span> <span class="n">FileFormat</span><span class="p">.</span><span class="na">PARQUET</span><span class="p">,</span> <span class="n">uri</span><span class="p">);</span>
<span class="n">Dataset</span> <span class="n">dataset</span> <span class="o">=</span> <span class="n">factory</span><span class="p">.</span><span class="na">finish</span><span class="p">();</span>
<span class="n">Scanner</span> <span class="n">scanner</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="na">newScan</span><span class="p">(</span><span class="k">new</span> <span class="n">ScanOptions</span><span class="p">(</span><span class="mi">100</span><span class="p">)));</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">ArrowRecordBatch</span><span class="o">&gt;</span> <span class="n">batches</span> <span class="o">=</span> <span class="n">StreamSupport</span><span class="p">.</span><span class="na">stream</span><span class="p">(</span>
    <span class="n">scanner</span><span class="p">.</span><span class="na">scan</span><span class="p">().</span><span class="na">spliterator</span><span class="p">(),</span> <span class="kc">false</span><span class="p">)</span>
        <span class="p">.</span><span class="na">flatMap</span><span class="p">(</span><span class="n">t</span> <span class="o">-&gt;</span> <span class="n">stream</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="na">execute</span><span class="p">()))</span>
        <span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span>

<span class="c1">// do something with read record batches, for example:</span>
<span class="n">analyzeArrowData</span><span class="p">(</span><span class="n">batches</span><span class="p">);</span>

<span class="c1">// finished the analysis of the data, close all resources:</span>
<span class="n">AutoCloseables</span><span class="p">.</span><span class="na">close</span><span class="p">(</span><span class="n">batches</span><span class="p">);</span>
<span class="n">AutoCloseables</span><span class="p">.</span><span class="na">close</span><span class="p">(</span><span class="n">factory</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">scanner</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">ArrowRecordBatch</span></code> is a low-level composite Arrow data exchange format
that doesn’t provide API to read typed data from it directly.
It’s recommended to use utilities <code class="docutils literal notranslate"><span class="pre">VectorLoader</span></code> to load it into a schema
aware container <code class="docutils literal notranslate"><span class="pre">VectorSchemaRoot</span></code> by which user could be able to access
decoded data conveniently in Java.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Load record batches with <a class="reference internal" href="vector_schema_root.html"><span class="doc">VectorSchemaRoot</span></a>.</p>
</div>
</div>
<div class="section" id="schema">
<h2>Schema<a class="headerlink" href="#schema" title="Permalink to this headline">¶</a></h2>
<p>Schema of the data to be queried can be inspected via method
<code class="docutils literal notranslate"><span class="pre">DatasetFactory#inspect()</span></code> before actually reading it. For example:</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="c1">// read data from local file /opt/example.parquet</span>
<span class="n">String</span> <span class="n">uri</span> <span class="o">=</span> <span class="s">&quot;file:/opt/example.parquet&quot;</span><span class="p">;</span>
<span class="n">BufferAllocator</span> <span class="n">allocator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RootAllocator</span><span class="p">(</span><span class="n">Long</span><span class="p">.</span><span class="na">MAX_VALUE</span><span class="p">);</span>
<span class="n">DatasetFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileSystemDatasetFactory</span><span class="p">(</span><span class="n">allocator</span><span class="p">,</span>
    <span class="n">NativeMemoryPool</span><span class="p">.</span><span class="na">getDefault</span><span class="p">(),</span> <span class="n">FileFormat</span><span class="p">.</span><span class="na">PARQUET</span><span class="p">,</span> <span class="n">uri</span><span class="p">);</span>

<span class="c1">// inspect schema</span>
<span class="n">Schema</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">factory</span><span class="p">.</span><span class="na">inspect</span><span class="p">();</span>
</pre></div>
</div>
<p>For some of the data format that is compatible with a user-defined schema, user
can use method <code class="docutils literal notranslate"><span class="pre">DatasetFactory#inspect(Schema</span> <span class="pre">schema)</span></code> to create the dataset:</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="n">Schema</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">createUserSchema</span><span class="p">()</span>
<span class="n">Dataset</span> <span class="n">dataset</span> <span class="o">=</span> <span class="n">factory</span><span class="p">.</span><span class="na">finish</span><span class="p">(</span><span class="n">schema</span><span class="p">);</span>
</pre></div>
</div>
<p>Otherwise when the non-parameter method <code class="docutils literal notranslate"><span class="pre">DatasetFactory#inspect()</span></code> is called,
schema will be inferred automatically from data source. The same as the result
of <code class="docutils literal notranslate"><span class="pre">DatasetFactory#inspect()</span></code>.</p>
<p>Also, if projector is specified during scanning (see next section
<a class="reference internal" href="#java-dataset-projection"><span class="std std-ref">Projection</span></a>), the actual schema of output data can be got
within method <code class="docutils literal notranslate"><span class="pre">Scanner::schema()</span></code>:</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="n">Scanner</span> <span class="n">scanner</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="na">newScan</span><span class="p">(</span>
    <span class="k">new</span> <span class="n">ScanOptions</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">Optional</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="k">new</span> <span class="n">String</span><span class="o">[]</span> <span class="p">{</span><span class="s">&quot;id&quot;</span><span class="p">,</span> <span class="s">&quot;name&quot;</span><span class="p">})));</span>
<span class="n">Schema</span> <span class="n">projectedSchema</span> <span class="o">=</span> <span class="n">scanner</span><span class="p">.</span><span class="na">schema</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="projection">
<span id="java-dataset-projection"></span><h2>Projection<a class="headerlink" href="#projection" title="Permalink to this headline">¶</a></h2>
<p>User can specify projections in ScanOptions. For <code class="docutils literal notranslate"><span class="pre">FileSystemDataset</span></code>, only
column projection is allowed for now, which means, only column names
in the projection list will be accepted. For example:</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="n">String</span><span class="o">[]</span> <span class="n">projection</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]</span> <span class="p">{</span><span class="s">&quot;id&quot;</span><span class="p">,</span> <span class="s">&quot;name&quot;</span><span class="p">};</span>
<span class="n">ScanOptions</span> <span class="n">options</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ScanOptions</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">Optional</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">projection</span><span class="p">));</span>
</pre></div>
</div>
<p>If no projection is needed, leave the optional projection argument absent in
ScanOptions:</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="n">ScanOptions</span> <span class="n">options</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ScanOptions</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">Optional</span><span class="p">.</span><span class="na">empty</span><span class="p">());</span>
</pre></div>
</div>
<p>Or use shortcut construtor:</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="n">ScanOptions</span> <span class="n">options</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ScanOptions</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
</pre></div>
</div>
<p>Then all columns will be emitted during scanning.</p>
</div>
<div class="section" id="read-data-from-hdfs">
<h2>Read Data from HDFS<a class="headerlink" href="#read-data-from-hdfs" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">FileSystemDataset</span></code> supports reading data from non-local file systems. HDFS
support is included in the official Apache Arrow Java package releases and
can be used directly without re-building the source code.</p>
<p>To access HDFS data using Dataset API, pass a general HDFS URI to
<code class="docutils literal notranslate"><span class="pre">FilesSystemDatasetFactory</span></code>:</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">uri</span> <span class="o">=</span> <span class="s">&quot;hdfs://{hdfs_host}:{port}/data/example.parquet&quot;</span><span class="p">;</span>
<span class="n">BufferAllocator</span> <span class="n">allocator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RootAllocator</span><span class="p">(</span><span class="n">Long</span><span class="p">.</span><span class="na">MAX_VALUE</span><span class="p">);</span>
<span class="n">DatasetFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileSystemDatasetFactory</span><span class="p">(</span><span class="n">allocator</span><span class="p">,</span>
    <span class="n">NativeMemoryPool</span><span class="p">.</span><span class="na">getDefault</span><span class="p">(),</span> <span class="n">FileFormat</span><span class="p">.</span><span class="na">PARQUET</span><span class="p">,</span> <span class="n">uri</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="native-memory-management">
<h2>Native Memory Management<a class="headerlink" href="#native-memory-management" title="Permalink to this headline">¶</a></h2>
<p>To gain better performance and reduce code complexity, Java
<code class="docutils literal notranslate"><span class="pre">FileSystemDataset</span></code> internally relys on C++
<code class="docutils literal notranslate"><span class="pre">arrow::dataset::FileSystemDataset</span></code> via JNI.
As a result, all Arrow data read from <code class="docutils literal notranslate"><span class="pre">FileSystemDataset</span></code> is supposed to be
allocated off the JVM heap. To manage this part of memory, an utility class
<code class="docutils literal notranslate"><span class="pre">NativeMemoryPool</span></code> is provided to users.</p>
<p>As a basic example, by using a listenable <code class="docutils literal notranslate"><span class="pre">NativeMemoryPool</span></code>, user can pass
a listener hooking on C++ buffer allocation/deallocation:</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="n">AtomicLong</span> <span class="n">reserved</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicLong</span><span class="p">(</span><span class="mi">0</span><span class="n">L</span><span class="p">);</span>
<span class="n">ReservationListener</span> <span class="n">listener</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ReservationListener</span><span class="p">()</span> <span class="p">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">reserve</span><span class="p">(</span><span class="kt">long</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">reserved</span><span class="p">.</span><span class="na">getAndAdd</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">unreserve</span><span class="p">(</span><span class="kt">long</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">reserved</span><span class="p">.</span><span class="na">getAndAdd</span><span class="p">(</span><span class="o">-</span><span class="n">size</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="n">NativeMemoryPool</span> <span class="n">pool</span> <span class="o">=</span> <span class="n">NativeMemoryPool</span><span class="p">.</span><span class="na">createListenable</span><span class="p">(</span><span class="n">listener</span><span class="p">);</span>
<span class="n">FileSystemDatasetFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileSystemDatasetFactory</span><span class="p">(</span><span class="n">allocator</span><span class="p">,</span>
    <span class="n">pool</span><span class="p">,</span> <span class="n">FileFormat</span><span class="p">.</span><span class="na">PARQUET</span><span class="p">,</span> <span class="n">uri</span><span class="p">);</span>
</pre></div>
</div>
<p>Also, it’s a very common case to reserve the same amount of JVM direct memory
for the data read from datasets. For this use a built-in utility
class <code class="docutils literal notranslate"><span class="pre">DirectReservationListener</span></code> is provided:</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="n">NativeMemoryPool</span> <span class="n">pool</span> <span class="o">=</span> <span class="n">NativeMemoryPool</span><span class="p">.</span><span class="na">createListenable</span><span class="p">(</span>
    <span class="n">DirectReservationListener</span><span class="p">.</span><span class="na">instance</span><span class="p">());</span>
</pre></div>
</div>
<p>This way, once the allocated byte count of Arrow buffers reaches the limit of
JVM direct memory, <code class="docutils literal notranslate"><span class="pre">OutOfMemoryError:</span> <span class="pre">Direct</span> <span class="pre">buffer</span> <span class="pre">memory</span></code> will
be thrown during scanning.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default instance <code class="docutils literal notranslate"><span class="pre">NativeMemoryPool.getDefaultMemoryPool()</span></code> does
nothing on buffer allocation/deallocation. It’s OK to use it in
the case of POC or testing, but for production use in complex environment,
it’s recommended to manage memory by using a listenable memory pool.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">BufferAllocator</span></code> instance passed to <code class="docutils literal notranslate"><span class="pre">FileSystemDatasetFactory</span></code>’s
constructor is also aware of the overall memory usage of the produced
dataset instances. Once the Java buffers are created the passed allocator
will become their parent allocator.</p>
</div>
</div>
<div class="section" id="native-object-resource-management">
<h2>Native Object Resource Management<a class="headerlink" href="#native-object-resource-management" title="Permalink to this headline">¶</a></h2>
<p>As another result of relying on JNI, all components related to
<code class="docutils literal notranslate"><span class="pre">FileSystemDataset</span></code> should be closed manually to release the corresponding
native objects after using. For example:</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="n">DatasetFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileSystemDatasetFactory</span><span class="p">(</span><span class="n">allocator</span><span class="p">,</span>
    <span class="n">NativeMemoryPool</span><span class="p">.</span><span class="na">getDefault</span><span class="p">(),</span> <span class="n">FileFormat</span><span class="p">.</span><span class="na">PARQUET</span><span class="p">,</span> <span class="n">uri</span><span class="p">);</span>
<span class="n">Dataset</span> <span class="n">dataset</span> <span class="o">=</span> <span class="n">factory</span><span class="p">.</span><span class="na">finish</span><span class="p">();</span>
<span class="n">Scanner</span> <span class="n">scanner</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="na">newScan</span><span class="p">(</span><span class="k">new</span> <span class="n">ScanOptions</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>

<span class="c1">// do something</span>

<span class="n">AutoCloseables</span><span class="p">.</span><span class="na">close</span><span class="p">(</span><span class="n">factory</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">scanner</span><span class="p">);</span>
</pre></div>
</div>
<p>If user forgets to close them then native object leakage might be caused.</p>
</div>
</div>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="algorithm.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Java Algorithms</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="reference/index.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Java Reference (javadoc)</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2016-2022 Apache Software Foundation.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.2.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>