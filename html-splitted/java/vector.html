
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ValueVector &#8212; Apache Arrow v7.0.0.dev574+gbd1ea0bfe</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/blank.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/theme_overrides.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="canonical" href="https://arrow.apache.org/docs/java/vector.html" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="VectorSchemaRoot" href="vector_schema_root.html" />
    <link rel="prev" title="Java Implementation" href="index.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-107500873-1', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    


    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
<a class="navbar-brand" href="../index.html">
  <img src="../_static/arrow.png" class="logo" alt="logo">
</a>


<div id="subproject-button" class="dropdown">
  <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    placeholder
  </button>
  <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
      
      <a class="nav-link" href="/c_glib">C/GLib</a>
      
      <a class="nav-link" href="/cpp">C++</a>
      
      <a class="nav-link" href="https://github.com/apache/arrow/blob/master/csharp/README.md">C#</a>
      
      <a class="nav-link" href="https://godoc.org/github.com/apache/arrow/go/arrow">Go</a>
      
      <a class="nav-link" href="/java">Java</a>
      
      <a class="nav-link" href="/js">JavaScript</a>
      
      <a class="nav-link" href="https://github.com/apache/arrow/blob/master/julia/Arrow/README.md">Julia</a>
      
      <a class="nav-link" href="https://github.com/apache/arrow/blob/master/matlab/README.md">MATLAB</a>
      
      <a class="nav-link" href="/python">Python</a>
      
      <a class="nav-link" href="/r">R</a>
      
      <a class="nav-link" href="https://github.com/apache/arrow/blob/master/ruby/README.md">Ruby</a>
      
      <a class="nav-link" href="https://docs.rs/crate/arrow/">Rust</a>
      
      <a class="nav-link" href="/status.html">Implementation status</a>
      
      <a class="nav-link" href="/format">Specifications and Protocols</a>
      
      <a class="nav-link" href="/developers">Developer documentation</a>
      
 </div>
</div>

<div id="version-search-wrapper">

<div id="version-button" class="dropdown">
    <button type="button" class="btn btn-secondary btn-sm navbar-btn dropdown-toggle" id="version_switcher_button" data-toggle="dropdown">
        7.0.0 (dev)
        <span class="caret"></span>
    </button>
    <div id="version_switcher" class="dropdown-menu list-group-flush py-0" aria-labelledby="version_switcher_button">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
</div>

<script type="text/javascript">
// Function to construct the target URL from the JSON components
function buildURL(entry) {
    var template = "https://arrow.apache.org/docs/{version}";  // supplied by jinja
    template = template.replace("{version}", entry.version);
    return template;
}

// Function to check if corresponding page path exists in other version of docs
// and, if so, go there instead of the homepage of the other docs version
function checkPageExistsAndRedirect(event) {
    const currentFilePath = "java/vector.html",
          otherDocsHomepage = event.target.getAttribute("href");
    let tryUrl = `${otherDocsHomepage}${currentFilePath}`;
    $.ajax({
        type: 'HEAD',
        url: tryUrl,
        // if the page exists, go there
        success: function() {
            location.href = tryUrl;
        }
    }).fail(function() {
        location.href = otherDocsHomepage;
    });
    return false;
}

// Function to populate the version switcher
(function () {
    // get JSON config
    $.getJSON("/docs/_static/versions.json", function(data, textStatus, jqXHR) {
        // create the nodes first (before AJAX calls) to ensure the order is
        // correct (for now, links will go to doc version homepage)
        $.each(data, function(index, entry) {
            // if no custom name specified (e.g., "latest"), use version string
            if (!("name" in entry)) {
                entry.name = entry.version;
            }
            // construct the appropriate URL, and add it to the dropdown
            entry.url = buildURL(entry);
            const node = document.createElement("a");
            node.setAttribute("class", "list-group-item list-group-item-action py-1");
            node.setAttribute("href", `${entry.url}`);
            node.textContent = `${entry.name}`;
            node.onclick = checkPageExistsAndRedirect;
            $("#version_switcher").append(node);
        });
    });
})();
</script>

<form id="search-box" class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>

</div>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
    <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Supported Environments
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../c_glib/index.html">
   C/GLib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/apache/arrow/blob/master/csharp/README.md">
   C#
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://pkg.go.dev/github.com/apache/arrow/go">
   Go
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   Java
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     ValueVector
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="vector_schema_root.html">
     VectorSchemaRoot
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ipc.html">
     Reading/Writing IPC formats
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="algorithm.html">
     Java Algorithms
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dataset.html">
     Dataset
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="reference/index.html">
     Reference (javadoc)
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../js/index.html">
   JavaScript
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/apache/arrow/blob/master/julia/Arrow/README.md">
   Julia
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/apache/arrow/blob/master/matlab/README.md">
   MATLAB
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../r/index.html">
   R
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/apache/arrow/blob/master/ruby/README.md">
   Ruby
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://docs.rs/crate/arrow/">
   Rust
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../status.html">
   Implementation Status
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Cookbooks
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference external" href="https://arrow.apache.org/cookbook/cpp/">
   C++
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://arrow.apache.org/cookbook/py/">
   Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://arrow.apache.org/cookbook/r/">
   R
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../format/index.html">
   Specifications and Protocols
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../format/Versioning.html">
     Format Versioning and Stability
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../format/Columnar.html">
     Arrow Columnar Format
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../format/Flight.html">
     Arrow Flight RPC
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../format/Integration.html">
     Integration Testing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../format/CDataInterface.html">
     The Arrow C data interface
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../format/CStreamInterface.html">
     The Arrow C stream interface
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../format/Other.html">
     Other Data Structures
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../developers/index.html">
   Developers documentation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../developers/contributing.html">
     Contributing to Apache Arrow
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../developers/guide/index.html">
     New Contributor‚Äôs Guide
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../developers/guide/architectural_overview.html">
       Architectural Overview
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../developers/guide/communication.html">
       Communication
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../developers/guide/step_by_step/index.html">
       Steps in making your first PR
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
      <label for="toctree-checkbox-5">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../developers/guide/step_by_step/set_up.html">
         Set up
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../developers/guide/step_by_step/building.html">
         Building the Arrow libraries üèãüèø‚Äç‚ôÄÔ∏è
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../developers/guide/step_by_step/finding_issues.html">
         Finding good first issues üîé
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../developers/guide/step_by_step/arrow_codebase.html">
         Working on the Arrow codebase üßê
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../developers/guide/step_by_step/testing.html">
         Testing üß™
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../developers/guide/step_by_step/pr_and_github.html">
         Lifecycle of a pull request
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../developers/guide/documentation.html">
       Helping with documentation
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../developers/guide/tutorials/index.html">
       Tutorials
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
      <label for="toctree-checkbox-6">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../developers/guide/tutorials/python_tutorial.html">
         Python tutorial
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../developers/guide/tutorials/r_tutorial.html">
         R tutorial
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../developers/guide/resources.html">
       Additional information and resources
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../developers/reviewing.html">
     Reviewing contributions
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../developers/cpp/index.html">
     C++ Development
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
    <label for="toctree-checkbox-7">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../developers/cpp/building.html">
       Building Arrow C++
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../developers/cpp/development.html">
       Development Guidelines
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../developers/cpp/windows.html">
       Developing on Windows
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../developers/cpp/conventions.html">
       Conventions
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../developers/cpp/fuzzing.html">
       Fuzzing Arrow C++
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../developers/python.html">
     Python Development
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../developers/continuous_integration/index.html">
     Continuous Integration
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
    <label for="toctree-checkbox-8">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../developers/continuous_integration/overview.html">
       Continuous Integration
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../developers/continuous_integration/docker.html">
       Running Docker Builds
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../developers/continuous_integration/archery.html">
       Daily Development using Archery
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../developers/continuous_integration/crossbow.html">
       Packaging and Testing with Crossbow
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../developers/benchmarks.html">
     Benchmarks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../developers/documentation.html">
     Building the Documentation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../developers/computeir.html">
     Arrow Compute IR (Intermediate Representation)
    </a>
   </li>
  </ul>
 </li>
</ul>

    
  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#vector-life-cycle">
   Vector Life Cycle
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#building-valuevector">
   Building ValueVector
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#building-listvector">
   Building ListVector
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#slicing">
   Slicing
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                

<div class="tocsection editthispage">
    <a href="https://github.com/apache/arrow/edit/master/docs/source/java/vector.rst">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="valuevector">
<h1>ValueVector<a class="headerlink" href="#valuevector" title="Permalink to this headline">¬∂</a></h1>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">ValueVector</span></code> interface (which called Array in C++ implementation and
the <a class="reference internal" href="../format/Columnar.html"><span class="doc">the specification</span></a>) is an abstraction that is used to store a
sequence of values having the same type in an individual column. Internally, those values are
represented by one or several buffers, the number and meaning of which depend on the vector‚Äôs data type.</p>
<p>There are concrete subclasses of <code class="xref py py-class docutils literal notranslate"><span class="pre">ValueVector</span></code> for each primitive data type
and nested type described in the specification. There are a few differences in naming
with the type names described in the specification:
Table with non-intuitive names (BigInt = 64 bit integer, etc).</p>
<p>It is important that vector is allocated before attempting to read or write,
<code class="xref py py-class docutils literal notranslate"><span class="pre">ValueVector</span></code> ‚Äúshould‚Äù strive to guarantee this order of operation:
create &gt; allocate &gt; mutate &gt; set value count &gt; access &gt; clear (or allocate to start the process over).
We will go through a concrete example to demonstrate each operation in the next section.</p>
<div class="section" id="vector-life-cycle">
<h2>Vector Life Cycle<a class="headerlink" href="#vector-life-cycle" title="Permalink to this headline">¬∂</a></h2>
<p>As discussed above, each vector goes through several steps in its life cycle,
and each step is triggered by a vector operation. In particular, we have the following vector operations:</p>
<p>1. <strong>Vector creation</strong>: we create a new vector object by, for example, the vector constructor.
The following code creates a new <code class="docutils literal notranslate"><span class="pre">IntVector</span></code> by the constructor:</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="n">RootAllocator</span> <span class="n">allocator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RootAllocator</span><span class="p">(</span><span class="n">Long</span><span class="p">.</span><span class="na">MAX_VALUE</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">IntVector</span> <span class="n">vector</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IntVector</span><span class="p">(</span><span class="s">&quot;int vector&quot;</span><span class="p">,</span> <span class="n">allocator</span><span class="p">);</span>
</pre></div>
</div>
<p>By now, a vector object is created. However, no underlying memory has been allocated, so we need the
following step.</p>
<p>2. <strong>Vector allocation</strong>: in this step, we allocate memory for the vector. For most vectors, we
have two options: 1) if we know the maximum vector capacity, we can specify it by calling the
<code class="docutils literal notranslate"><span class="pre">allocateNew(int)</span></code> method; 2) otherwise, we should call the <code class="docutils literal notranslate"><span class="pre">allocateNew()</span></code> method, and  a default
capacity will be allocated for it. For our running example, we assume that the vector capacity never
exceeds 10:</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="n">vector</span><span class="p">.</span><span class="na">allocateNew</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</pre></div>
</div>
<p>3. <strong>Vector mutation</strong>: now we can populate the vector with values we desire. For all vectors, we can populate
vector values through vector writers (An example will be given in the next section). For primitive types,
we can also mutate the vector by the set methods. There are two classes of set methods: 1) if we can
be sure the vector has enough capacity, we can call the <code class="docutils literal notranslate"><span class="pre">set(index,</span> <span class="pre">value)</span></code> method. 2) if we are not sure
about the vector capacity, we should call the <code class="docutils literal notranslate"><span class="pre">setSafe(index,</span> <span class="pre">value)</span></code> method, which will automatically
take care of vector reallocation, if the capacity is not sufficient. For our running example, we know the
vector has enough capacity, so we can call</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="n">vector</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="cm">/*index*/</span><span class="mi">5</span><span class="p">,</span> <span class="cm">/*value*/</span><span class="mi">25</span><span class="p">);</span>
</pre></div>
</div>
<p>4. <strong>Set value count</strong>: for this step, we set the value count of the vector by calling the
<code class="docutils literal notranslate"><span class="pre">setValueCount(int)</span></code> method:</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="n">vector</span><span class="p">.</span><span class="na">setValueCount</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</pre></div>
</div>
<p>After this step, the vector enters an immutable state. In other words, we should no longer mutate it.
(Unless we reuse the vector by allocating it again. This will be discussed shortly.)</p>
<p>5. <strong>Vector access</strong>: it is time to access vector values. Similarly, we have two options to access values:
1) get methods and 2) vector reader. Vector reader works for all types of vectors, while get methods are
only available for primitive vectors. A concrete example for vector reader will be given in the next section.
Below is an example of vector access by get method:</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">value</span> <span class="o">=</span> <span class="n">vector</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>  <span class="c1">// value == 25</span>
</pre></div>
</div>
<p>6. <strong>Vector clear</strong>: when we are done with the vector, we should clear it to release its memory. This is done by
calling the <code class="docutils literal notranslate"><span class="pre">close()</span></code> method:</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="n">vector</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
</pre></div>
</div>
<p>Some points to note about the steps above:</p>
<ul class="simple">
<li><p>The steps are not necessarily performed in a linear sequence. Instead, they can be in a loop. For example,
when a vector enters the access step, we can also go back to the vector mutation step, and then set value
count, access vector, and so on.</p></li>
<li><p>We should try to make sure the above steps are carried out in order. Otherwise, the vector
may be in an undefined state, and some unexpected behavior may occur. However, this restriction
is not strict. That means it is possible that we violates the order above, but still get
correct results.</p></li>
<li><p>When mutating vector values through set methods, we should prefer <code class="docutils literal notranslate"><span class="pre">set(index,</span> <span class="pre">value)</span></code> methods to
<code class="docutils literal notranslate"><span class="pre">setSafe(index,</span> <span class="pre">value)</span></code> methods whenever possible, to avoid unnecessary performance overhead of handling
vector capacity.</p></li>
<li><p>All vectors implement the <code class="docutils literal notranslate"><span class="pre">AutoCloseable</span></code> interface. So they must be closed explicitly when they are
no longer used, to avoid resource leak. To make sure of this, it is recommended to place vector related operations
into a try-with-resources block.</p></li>
<li><p>For fixed width vectors (e.g. IntVector), we can set values at different indices in arbitrary orders.
For variable width vectors (e.g. VarCharVector), however, we must set values in non-decreasing order of the
indices. Otherwise, the values after the set position will become invalid. For example, suppose we use the
following statements to populate a variable width vector:</p></li>
</ul>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="n">VarCharVector</span> <span class="n">vector</span> <span class="o">=</span> <span class="k">new</span> <span class="n">VarCharVector</span><span class="p">(</span><span class="s">&quot;vector&quot;</span><span class="p">,</span> <span class="n">allocator</span><span class="p">);</span>
<span class="n">vector</span><span class="p">.</span><span class="na">allocateNew</span><span class="p">();</span>
<span class="n">vector</span><span class="p">.</span><span class="na">setSafe</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;zero&quot;</span><span class="p">);</span>
<span class="n">vector</span><span class="p">.</span><span class="na">setSafe</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;one&quot;</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">vector</span><span class="p">.</span><span class="na">setSafe</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="s">&quot;nine&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Then we set the value at position 5 again:</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="n">vector</span><span class="p">.</span><span class="na">setSafe</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s">&quot;5&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>After that, the values at positions 6, 7, 8, and 9 of the vector will become invalid.</p>
</div>
<div class="section" id="building-valuevector">
<h2>Building ValueVector<a class="headerlink" href="#building-valuevector" title="Permalink to this headline">¬∂</a></h2>
<p>Note that the current implementation doesn‚Äôt enforce the rule that Arrow objects are immutable.
<code class="xref py py-class docutils literal notranslate"><span class="pre">ValueVector</span></code> instances could be created directly by using new keyword, there are
set/setSafe APIs and concrete subclasses of FieldWriter for populating values.</p>
<p>For example, the code below shows how to build a <code class="xref py py-class docutils literal notranslate"><span class="pre">BigIntVector</span></code>, in this case, we build a
vector of the range 0 to 7 where the element that should hold the fourth value is nulled</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="k">try</span> <span class="p">(</span><span class="n">BufferAllocator</span> <span class="n">allocator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RootAllocator</span><span class="p">(</span><span class="n">Long</span><span class="p">.</span><span class="na">MAX_VALUE</span><span class="p">);</span>
  <span class="n">BigIntVector</span> <span class="n">vector</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BigIntVector</span><span class="p">(</span><span class="s">&quot;vector&quot;</span><span class="p">,</span> <span class="n">allocator</span><span class="p">))</span> <span class="p">{</span>
  <span class="n">vector</span><span class="p">.</span><span class="na">allocateNew</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>
  <span class="n">vector</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  <span class="n">vector</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
  <span class="n">vector</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
  <span class="n">vector</span><span class="p">.</span><span class="na">setNull</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
  <span class="n">vector</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
  <span class="n">vector</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
  <span class="n">vector</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
  <span class="n">vector</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
  <span class="n">vector</span><span class="p">.</span><span class="na">setValueCount</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span> <span class="c1">// this will finalizes the vector by convention.</span>
  <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">BigIntVector</span></code> holds two ArrowBufs. The first buffer holds the null bitmap, which consists
here of a single byte with the bits 1|1|1|1|0|1|1|1 (the bit is 1 if the value is non-null).
The second buffer contains all the above values. As the fourth entry is null, the value at that position
in the buffer is undefined. Note compared with set API, setSafe API would check value capacity before setting
values and reallocate buffers if necessary.</p>
<p>Here is how to build a vector using writer</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="k">try</span> <span class="p">(</span><span class="n">BigIntVector</span> <span class="n">vector</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BigIntVector</span><span class="p">(</span><span class="s">&quot;vector&quot;</span><span class="p">,</span> <span class="n">allocator</span><span class="p">);</span>
  <span class="n">BigIntWriter</span> <span class="n">writer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BigIntWriterImpl</span><span class="p">(</span><span class="n">vector</span><span class="p">))</span> <span class="p">{</span>
  <span class="n">writer</span><span class="p">.</span><span class="na">setPosition</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="n">writer</span><span class="p">.</span><span class="na">writeBigInt</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="n">writer</span><span class="p">.</span><span class="na">setPosition</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="n">writer</span><span class="p">.</span><span class="na">writeBigInt</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="n">writer</span><span class="p">.</span><span class="na">setPosition</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="n">writer</span><span class="p">.</span><span class="na">writeBigInt</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
  <span class="c1">// writer.setPosition(3) is not called which means the forth value is null.</span>
  <span class="n">writer</span><span class="p">.</span><span class="na">setPosition</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
  <span class="n">writer</span><span class="p">.</span><span class="na">writeBigInt</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
  <span class="n">writer</span><span class="p">.</span><span class="na">setPosition</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
  <span class="n">writer</span><span class="p">.</span><span class="na">writeBigInt</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span>
  <span class="n">writer</span><span class="p">.</span><span class="na">setPosition</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span>
  <span class="n">writer</span><span class="p">.</span><span class="na">writeBigInt</span><span class="p">(</span><span class="mi">7</span><span class="p">);</span>
  <span class="n">writer</span><span class="p">.</span><span class="na">setPosition</span><span class="p">(</span><span class="mi">7</span><span class="p">);</span>
  <span class="n">writer</span><span class="p">.</span><span class="na">writeBigInt</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>There are get API and concrete subclasses of <code class="xref py py-class docutils literal notranslate"><span class="pre">FieldReader</span></code> for accessing vector values, what needs
to be declared is that writer/reader is not as efficient as direct access</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="c1">// access via get API</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">vector</span><span class="p">.</span><span class="na">getValueCount</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">vector</span><span class="p">.</span><span class="na">isNull</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">vector</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// access via reader</span>
<span class="n">BigIntReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="n">vector</span><span class="p">.</span><span class="na">getReader</span><span class="p">();</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">vector</span><span class="p">.</span><span class="na">getValueCount</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">reader</span><span class="p">.</span><span class="na">setPosition</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="na">isSet</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="na">readLong</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="building-listvector">
<h2>Building ListVector<a class="headerlink" href="#building-listvector" title="Permalink to this headline">¬∂</a></h2>
<p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">ListVector</span></code> is a vector that holds a list of values for each index. Working with one you need to handle the same steps as mentioned above (create &gt; allocate &gt; mutate &gt; set value count &gt; access &gt; clear), but the details of how you accomplish this are slightly different since you need to both create the vector and set the list of values for each index.</p>
<p>For example, the code below shows how to build a <code class="xref py py-class docutils literal notranslate"><span class="pre">ListVector</span></code> of int‚Äôs using the writer <code class="xref py py-class docutils literal notranslate"><span class="pre">UnionListWriter</span></code>. We build a vector from 0 to 9 and each index contains a list with values [[0, 0, 0, 0, 0], [0, 1, 2, 3, 4], [0, 2, 4, 6, 8], ‚Ä¶, [0, 9, 18, 27, 36]]. List values can be added in any order so writing a list such as [3, 1, 2] would be just as valid.</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="k">try</span> <span class="p">(</span><span class="n">BufferAllocator</span> <span class="n">allocator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RootAllocator</span><span class="p">(</span><span class="n">Long</span><span class="p">.</span><span class="na">MAX_VALUE</span><span class="p">);</span>
  <span class="n">ListVector</span> <span class="n">listVector</span> <span class="o">=</span> <span class="n">ListVector</span><span class="p">.</span><span class="na">empty</span><span class="p">(</span><span class="s">&quot;vector&quot;</span><span class="p">,</span> <span class="n">allocator</span><span class="p">))</span> <span class="p">{</span>
  <span class="n">UnionListWriter</span> <span class="n">writer</span> <span class="o">=</span> <span class="n">listVector</span><span class="p">.</span><span class="na">getWriter</span><span class="p">();</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">writer</span><span class="p">.</span><span class="na">startList</span><span class="p">();</span>
     <span class="n">writer</span><span class="p">.</span><span class="na">setPosition</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
     <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">writer</span><span class="p">.</span><span class="na">writeInt</span><span class="p">(</span><span class="n">j</span> <span class="o">*</span> <span class="n">i</span><span class="p">);</span>
     <span class="p">}</span>
     <span class="n">writer</span><span class="p">.</span><span class="na">setValueCount</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
     <span class="n">writer</span><span class="p">.</span><span class="na">endList</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="n">listVector</span><span class="p">.</span><span class="na">setValueCount</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">ListVector</span></code> values can be accessed either through the get API or through the reader class <code class="xref py py-class docutils literal notranslate"><span class="pre">UnionListReader</span></code>. To read all the values, first enumerate through the indexes, and then enumerate through the inner list values.</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="c1">// access via get API</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">listVector</span><span class="p">.</span><span class="na">getValueCount</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">listVector</span><span class="p">.</span><span class="na">isNull</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="p">{</span>
       <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">elements</span> <span class="o">=</span> <span class="p">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="p">)</span> <span class="n">listVector</span><span class="p">.</span><span class="na">getObject</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
       <span class="k">for</span> <span class="p">(</span><span class="n">Integer</span> <span class="n">element</span> <span class="p">:</span> <span class="n">elements</span><span class="p">)</span> <span class="p">{</span>
           <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">element</span><span class="p">);</span>
       <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// access via reader</span>
<span class="n">UnionListReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="n">listVector</span><span class="p">.</span><span class="na">getReader</span><span class="p">();</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">listVector</span><span class="p">.</span><span class="na">getValueCount</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">reader</span><span class="p">.</span><span class="na">setPosition</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
   <span class="k">while</span> <span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="na">next</span><span class="p">())</span> <span class="p">{</span>
       <span class="n">IntReader</span> <span class="n">intReader</span> <span class="o">=</span> <span class="n">reader</span><span class="p">.</span><span class="na">reader</span><span class="p">();</span>
       <span class="k">if</span> <span class="p">(</span><span class="n">intReader</span><span class="p">.</span><span class="na">isSet</span><span class="p">())</span> <span class="p">{</span>
           <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">intReader</span><span class="p">.</span><span class="na">readInteger</span><span class="p">());</span>
       <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="slicing">
<h2>Slicing<a class="headerlink" href="#slicing" title="Permalink to this headline">¬∂</a></h2>
<p>Similar with C++ implementation, it is possible to make zero-copy slices of vectors to obtain a vector
referring to some logical sub-sequence of the data through <code class="xref py py-class docutils literal notranslate"><span class="pre">TransferPair</span></code></p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="n">IntVector</span> <span class="n">vector</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IntVector</span><span class="p">(</span><span class="s">&quot;intVector&quot;</span><span class="p">,</span> <span class="n">allocator</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">vector</span><span class="p">.</span><span class="na">setSafe</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">vector</span><span class="p">.</span><span class="na">setValueCount</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

<span class="n">TransferPair</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">vector</span><span class="p">.</span><span class="na">getTransferPair</span><span class="p">(</span><span class="n">allocator</span><span class="p">);</span>
<span class="n">tp</span><span class="p">.</span><span class="na">splitAndTransfer</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
<span class="n">IntVector</span> <span class="n">sliced</span> <span class="o">=</span> <span class="p">(</span><span class="n">IntVector</span><span class="p">)</span> <span class="n">tp</span><span class="p">.</span><span class="na">getTo</span><span class="p">();</span>
<span class="c1">// In this case, the vector values are [0, 1, 2, 3, 4, 5, 6, 7, 8, 9] and the sliceVector values are [0, 1, 2, 3, 4].</span>
</pre></div>
</div>
</div>
</div>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="index.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Java Implementation</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="vector_schema_root.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">VectorSchemaRoot</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2016-2022 Apache Software Foundation.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.2.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>